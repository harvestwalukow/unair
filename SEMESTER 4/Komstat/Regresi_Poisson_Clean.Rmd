---
title: "Perbaikan UAS"
author: "Harvest Ecclesiano Christ Walukow"
output: pdf_document
---

## a.

```{r}
library(maxLik)

poisson_loglik <- function(beta, y, X) {
  mu <- exp(X %*% beta)                          # hitung μ 
  loglik <- sum(y * log(mu) - mu - lfactorial(y)) # hitung log likelihood
  return(loglik)                                 # return positif untuk maksimisasi
}

poisson_gradient <- function(beta, y, X) {
  mu <- exp(X %*% beta)                          # hitung μ 
  gradient_matrix <- X * as.vector(y - mu)       # gradient untuk setiap observasi (matrix)
  return(gradient_matrix)                        # return matriks gradient (setiap baris = observasi)
}

estimate_poisson <- function(y, X) {
  start_values <- rep(0, ncol(X))                # nilai awal parameter
  
  result <- maxLik(logLik = poisson_loglik,      # maksimisasi likelihood dengan maxLik
                   grad = poisson_gradient,      # fungsi gradient
                   start = start_values,         # nilai awal
                   method = "BHHH",              # metode BHHH
                   y = y, X = X)                 # argumen tambahan
  
  estimates <- coef(result)                      # koefisien
  std_errors <- sqrt(diag(vcov(result)))         # standard errors
  z_values <- estimates / std_errors             # z statistics
  p_values <- 2 * (1 - pnorm(abs(z_values)))    # p-values
  
  return(data.frame(                             # return hasil dalam dataframe
    Estimate = estimates,
    Std_Error = std_errors,
    z_value = z_values,
    p_value = p_values,
    row.names = c("Intercept", paste0("x", 1:(ncol(X)-1)))
  ))
}
```

## b.

```{r}
data_up <- read.csv("Data UP.csv")               # baca data
data_up <- data_up[complete.cases(data_up), ]   # hapus missing values

y <- data_up$y                                   # variabel respons
X <- as.matrix(cbind(1, data_up[, 2:5]))        # matriks desain dengan intercept

hasil_manual <- estimate_poisson(y, X)          # estimasi dengan fungsi buatan sendiri
print(hasil_manual)

model_glm <- glm(y ~ x1 + x2 + x3 + x4, data = data_up, family = poisson()) # perbandingan dengan GLM
print(summary(model_glm)$coefficients)

cat("Selisih maksimum:", max(abs(hasil_manual$Estimate - coef(model_glm)))) # bandingkan koefisien
``` 